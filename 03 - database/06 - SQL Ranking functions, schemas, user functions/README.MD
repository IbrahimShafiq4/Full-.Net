# ๐ RANKING FUNCTIONS IN SQL

## ๐น ููู ุจูุณุชุฎุฏู Ranking Functionsุ

ุนูุดุงู:

* ูุฑุชูุจ ุงูุจูุงูุงุช
* ูุฌูุจ Top / Nth record
* ูุทูุน ุชุฑุชูุจ ููุทูู ุฃู ุชุณูุณูู

---

## 1๏ธโฃ ROW_NUMBER()

### ุงูููุฑุฉ

* ุจูุฏูู **ุฑูู ูุฑูุฏ ููู ุตู**
* **ูุด ุจูุญุณุจ ุงูุชูุฑุงุฑ**
* ุฏุงูููุง ุฃุฑูุงู ูุชุณูุณูุฉ

```sql
SELECT Ins_Name, Salary,
ROW_NUMBER() OVER (ORDER BY Salary DESC) AS RN
FROM Instructor;
```

### ุดูู ุงููุชูุฌุฉ

```
Salary | RN
--------------
5000   | 1
5000   | 2
4000   | 3
3000   | 4
```

๐ ุญุชู ูู ุงููุฑุชุจ ูุชูุฑุฑ โ ุงูุฑูู ูุฎุชูู

### ุงูุงุณุชุฎุฏุงู

* Top N
* Pagination
* ูุฌุฑุฏ ุนุฏู ุตููู

---

## 2๏ธโฃ DENSE_RANK()

### ุงูููุฑุฉ

* **ุจูุญุณุจ ุงูุชูุฑุงุฑ**
* **ูููุด ูุฌูุงุช**

```sql
SELECT Ins_Name, Salary,
DENSE_RANK() OVER (ORDER BY Salary DESC) AS DR
FROM Instructor;
```

### ุดูู ุงููุชูุฌุฉ

```
Salary | DR
--------------
5000   | 1
5000   | 1
4000   | 2
3000   | 3
```

### ุงูุงุณุชุฎุฏุงู

* ุชุฑุชูุจ ููุทูู
* ูุฑุงูุฒ ุจุฏูู ุฃุฑูุงู ุถุงูุนุฉ

---

## 3๏ธโฃ RANK()

### ุงูููุฑุฉ

* **ุจูุญุณุจ ุงูุชูุฑุงุฑ**
* **ุจูุณูุจ ูุฌูุงุช**

```sql
SELECT Ins_Name, Salary,
RANK() OVER (ORDER BY Salary DESC) AS R
FROM Instructor;
```

### ุดูู ุงููุชูุฌุฉ

```
Salary | R
--------------
5000   | 1
5000   | 1
4000   | 3
3000   | 4
```

๐ ุงูุฑูู 2 ุงุฎุชูู

---

## ๐ง ููุงุฑูุฉ ุณุฑูุนุฉ

| Function   | ุงูุชูุฑุงุฑ | ูุฌูุงุช |
| ---------- | ------- | ----- |
| ROW_NUMBER | โ       | โ     |
| DENSE_RANK | โ       | โ     |
| RANK       | โ       | โ     |

---

# ๐งฉ PARTITION BY vs GROUP BY

## ๐ธ GROUP BY

* ุจููููู ุนุฏุฏ ุงูุตููู
* ูุงุฒู Aggregation

```sql
SELECT Dept_Id, MIN(St_Age)
FROM Student
GROUP BY Dept_Id;
```

๐ ุงููุชูุฌุฉ ุตู ูุงุญุฏ ููู Department

---

## ๐ธ PARTITION BY

* ูุด ุจููููู ุงูุตููู
* ุจููุณูู ุงูุจูุงูุงุช ููุทูููุง

```sql
ROW_NUMBER() OVER (
  PARTITION BY Dept_Id
  ORDER BY St_Age
)
```

๐ ูู Department ูุจุฏุฃ ุชุฑุชูุจ ูู 1

---

## โ๏ธ ุฃุตุบุฑ ุทุงูุจ ูู ูู ูุณู (PARTITION BY)

```sql
SELECT *
FROM (
  SELECT Dept_Id, St_Fname, St_Age,
         ROW_NUMBER() OVER (
           PARTITION BY Dept_Id
           ORDER BY St_Age
         ) AS RN
  FROM Student
) T
WHERE RN = 1;
```

---

## โ๏ธ ููุณ ุงูููุฑุฉ ุจุงุณุชุฎุฏุงู JOIN

```sql
SELECT s.*
FROM Student s
JOIN (
  SELECT Dept_Id, MIN(St_Age) AS MinAge
  FROM Student
  GROUP BY Dept_Id
) m
ON s.Dept_Id = m.Dept_Id
AND s.St_Age = m.MinAge;
```

---

# ๐ NTILE()

## ุงูููุฑุฉ

* ุจุชูุณูู ุงูุตููู ูู `n` ูุฌููุนุงุช ูุชูุงุฑุจุฉ ูู ุงูุนุฏุฏ

```sql
SELECT Ins_Name, Salary,
NTILE(3) OVER (ORDER BY Salary DESC) AS G
FROM Instructor;
```

### ูุซุงู ุจุตุฑู

```
Rows = 9
NTILE(3)

Group 1 โ 1,2,3
Group 2 โ 4,5,6
Group 3 โ 7,8,9
```

---

## ๐ ูุนุงุฏูุฉ NTILE

```text
NTILE = CEILING( row_number * n / R )

R = ุนุฏุฏ ุงูุตููู
n = ุนุฏุฏ ุงูุฌุฑูุจุงุช
```

---

# โฑ EXECUTION ORDER

```text
FROM
ON
JOIN
WHERE
GROUP BY
HAVING
SELECT
DISTINCT
ORDER BY
TOP
```

---

## โ ููู FullName ููููุนุด ูู WHEREุ

```sql
SELECT CONCAT(St_Fname,' ',St_Lname) AS FullName
FROM Student
WHERE FullName = 'Ahmed Hassan';
```

๐ `WHERE` ุจุชุชููุฐ ูุจู `SELECT`

---

## โ๏ธ ุงูุญููู ุงูุตุญูุญุฉ

### ุงูุญู 1

```sql
WHERE CONCAT(St_Fname,' ',St_Lname) = 'Ahmed Hassan'
```

### ุงูุญู 2

```sql
SELECT *
FROM (
  SELECT CONCAT(St_Fname,' ',St_Lname) AS FullName
  FROM Student
) T
WHERE FullName = 'Ahmed Hassan';
```

---

# ๐ SCHEMA

## ุงููุดุงูู ุงููู ุญูููุง

1๏ธโฃ ุชูุฑุงุฑ ุฃุณูุงุก ุงูุฌุฏุงูู
2๏ธโฃ ุชูุธูู ููุทูู
3๏ธโฃ Permissions

### ูุซุงู

```sql
CREATE SCHEMA HR;
ALTER SCHEMA HR TRANSFER Student;
```

๐ ุฃู User ูู ุตูุงุญูุฉ HR โ ูุดูู ูู ุงูุฌุฏุงูู ุฌููู HR

---

# ๐ UNION FAMILY (ุดุฑุญ + ุฃูุซูุฉ)

## ุดุฑูุท UNION

1๏ธโฃ ููุณ ุนุฏุฏ ุงูุฃุนูุฏุฉ
2๏ธโฃ ููุณ ููุน ุงูุจูุงูุงุช

---

## ๐น UNION (ูุดูู ุงูุชูุฑุงุฑ)

```sql
SELECT St_Id, St_Fname
FROM Student
WHERE St_Id IS NOT NULL
UNION
SELECT Ins_Id, Ins_Name
FROM Instructor;
```

๐ ูู ููุณ ุงููููุฉ ุงุชูุฑุฑุช โ ุชุธูุฑ ูุฑุฉ ูุงุญุฏุฉ

---

## ๐น UNION ALL (ูุฌูุจ ุงููู)

```sql
SELECT St_Id, St_Fname
FROM Student
UNION ALL
SELECT Ins_Id, Ins_Name
FROM Instructor;
```

๐ ุฃุณุฑุน โ **ูุง ูุดูู ุงูุชูุฑุงุฑ**

---

## ๐น INTERSECT (ุงููุดุชุฑู)

```sql
SELECT St_Id, St_Fname
FROM Student
INTERSECT
SELECT Ins_Id, Ins_Name
FROM Instructor;
```

๐ ุจูุฑุฌุน ุงูููู ุงููู ููุฌูุฏุฉ ูู ุงูุงุชููู

---

## ๐น EXCEPT (ุงููุฑู)

```sql
SELECT St_Id, St_Fname
FROM Student
EXCEPT
SELECT Ins_Id, Ins_Name
FROM Instructor;
```

๐ ุงููู ูู Student ููุด ููุฌูุฏ ูู Instructor

---

## ๐ง ุดูู ุจุตุฑู

```
Student        Instructor
 A  B  C        B  C  D

INTERSECT โ B C
EXCEPT    โ A
UNION     โ A B C D
```

---

# ๐ง USER DEFINED FUNCTIONS

---

## 1๏ธโฃ Scalar Function

### ุจุชุฑุฌุน ูููุฉ ูุงุญุฏุฉ

```sql
CREATE FUNCTION GetStudentNameByStudentId(@Id INT)
RETURNS VARCHAR(20)
BEGIN
  DECLARE @Name VARCHAR(20)
  SELECT @Name = St_Fname
  FROM Student
  WHERE St_Id = @Id
  RETURN @Name
END
```

```sql
SELECT dbo.GetStudentNameByStudentId(10);
```

---

## ุฃูุซูุฉ Scalar ุฅุถุงููุฉ

### โ๏ธ ุนุฏุฏ ุทูุงุจ ุงููุณู

```sql
CREATE FUNCTION GetStudentsCountByDept(@DeptId INT)
RETURNS INT
BEGIN
  DECLARE @C INT
  SELECT @C = COUNT(*)
  FROM Student
  WHERE Dept_Id = @DeptId
  RETURN @C
END
```

---

## 2๏ธโฃ Inline Table Function

```sql
CREATE FUNCTION GetInstructorsByDept(@DeptId INT)
RETURNS TABLE
AS
RETURN (
  SELECT Ins_Name, Salary
  FROM Instructor
  WHERE Dept_Id = @DeptId
);
```

๐ ุฃูุถู Performance

---

## 3๏ธโฃ Multi Statement Table Function

```sql
CREATE FUNCTION GetStudentDataBasedOnFormat(@format VARCHAR(20))
RETURNS @T TABLE (Id INT, Name VARCHAR(100))
AS
BEGIN
  IF @format = 'first'
    INSERT INTO @T
    SELECT St_Id, ISNULL(St_Fname,'unknown')
    FROM Student;

  ELSE IF @format = 'full'
    INSERT INTO @T
    SELECT St_Id,
           CONCAT(ISNULL(St_Fname,'unknown'),' ',
                  ISNULL(St_Lname,'unknown'))
    FROM Student;

  RETURN;
END
```

---

## ๐ง ููุงุฑูุฉ Functions

| Type            | Return | Speed |
| --------------- | ------ | ----- |
| Scalar          | Value  | โ     |
| Inline Table    | Table  | โ     |
| Multi Statement | Table  | โ๏ธ    |